
var Question = require("../models/question.model.js");

function RenderViewWithQuestions(req, res) {
    let eventcode = req.body.eventcode;
    let username = req.body.username;
    //get question list and send it to view
    var query = Question.find({ Event: req.body.eventcode });
    query.exec(function (err, results) {
        res.render('dashboard', { title: 'Dashboard', eventcode: eventcode, questions: results, username: username });
    });
}

exports.createQuestion = function (req, res) {
    let eventcode = req.body.eventcode;
    var entry = new Question({
        //ID: Number,  -> autogenerated
        Event: eventcode,
        Text: req.body.QuestionText,
        Username: req.body.username,
        Rating: 0
    });

    entry.save();
     
    //res.render('dashboard', { title: 'New question included'});
    RenderViewWithQuestions(req, res);
}

exports.loadDashboard = function (req, res) {
    RenderViewWithQuestions(req, res);
}
